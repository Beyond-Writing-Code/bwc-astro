#!/bin/bash
# Pre-commit hook - runs quality checks before allowing commit

echo "üîç Running pre-commit checks..."

FAILED=0

# 1. Type check
echo "üöÄ Running Astro type check..."
npm run type-check --silent || { echo "‚ùå Type check failed"; FAILED=1; }

# 2. Build test (fast way to catch issues)
echo "üèóÔ∏è  Testing build..."
npm run build --silent || { echo "‚ùå Build failed"; FAILED=1; }

# 3. Security (warn only)
echo "üîí Security audit..."
npm run security:check --silent 2>/dev/null || echo "‚ö†Ô∏è  Security issues detected"

if [ $FAILED -ne 0 ]; then
    echo ""
    echo "‚ùå Pre-commit checks failed"
    echo "To bypass (not recommended): git commit --no-verify"
    exit 1
fi

echo "‚úÖ All checks passed!"
