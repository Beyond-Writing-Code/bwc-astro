---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import PostCard from '../../components/PostCard.astro';
import { getPublishedPosts, sortPostsByDate, getPostsByCategory } from '../../utils/post-filters';

export async function getStaticPaths() {
  const allPosts = await getCollection('posts');
  const publishedPosts = getPublishedPosts(allPosts);

  const categories = new Set<string>();
  publishedPosts.forEach((post) => {
    post.data.categories?.forEach((category) => categories.add(category));
  });

  return Array.from(categories).map((category) => {
    const categoryPosts = sortPostsByDate(getPostsByCategory(publishedPosts, category));

    return {
      params: { category },
      props: { category, posts: categoryPosts },
    };
  });
}

const { category, posts } = Astro.props;
---

<Layout
  title={`Posts in ${category}`}
  description={`All posts in the ${category} category on Beyond Writing Code.`}
>
  <div class="category-page">
    <h1 class="page-title">
      Posts in <span class="category-name">{category}</span>
    </h1>

    <div class="posts-list">
      {posts.map((post) => <PostCard post={post} />)}
    </div>

    <div class="back-link">
      <a href="/posts">‚Üê Back to all posts</a>
    </div>
  </div>
</Layout>

<style>
  .category-page {
    max-width: var(--content-max-width);
    margin: 0 auto;
    padding: var(--spacing-lg) 0;
  }

  .category-name {
    color: var(--color-accent-teal);
  }

  .posts-list {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-xl);
  }

  .back-link {
    margin-top: var(--spacing-xl);
    text-align: center;
  }

  .back-link a {
    color: var(--color-accent-teal);
    text-decoration: none;
    font-family: var(--font-sans);
  }

  .back-link a:hover {
    text-decoration: underline;
  }
</style>
